<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bilalbera'nÄ±n Click Oyunu)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937;
        }
        /* TÄ±klama Butonuna Ã–zel Stil */
        #clickButton {
            transition: all 0.1s ease;
            box-shadow: 0 6px #0d47a1; /* Daha koyu gÃ¶lge */
        }
        #clickButton:active {
            box-shadow: 0 0 #0d47a1;
            transform: translateY(6px);
        }
        /* Market kartlarÄ± iÃ§in kaydÄ±rma Ã§ubuÄŸu stili */
        #marketItems, #rebirthStoreItems {
            max-height: 500px;
            overflow-y: auto;
        }
        .view-container {
            min-height: 550px; /* GÃ¶rÃ¼nÃ¼mler arasÄ± geÃ§iÅŸte boyutu korumak iÃ§in */
        }
        .nav-btn.active {
            background-color: #f59e0b; /* Aktif sekme rengi */
            color: #1f2937;
        }
        /* RBP MaÄŸazasÄ± Butonu iÃ§in Ã¶zel stil */
        #navRebirthStore.active {
            background-color: #a78bfa; /* Mor ton */
            color: #1f2937;
        }
    </style>
</head>
<body class="text-white min-h-screen flex items-center justify-center p-4">

    <!-- Ana Oyun Konteyneri -->
    <div class="w-full max-w-4xl bg-gray-800 rounded-xl shadow-2xl p-6">
        <h1 class="text-4xl font-extrabold text-center mb-6 text-blue-400">THE CLICKER: Ã‡evrimdÄ±ÅŸÄ± KazanÃ§!</h1>

        <!-- Durum Bilgileri (Ãœst Panel) -->
        <div class="grid grid-cols-2 gap-4 p-4 mb-4 bg-gray-900 rounded-lg border border-gray-700">
            <!-- 1. Para -->
            <div class="col-span-1">
                <p class="text-base">ğŸ’° Para:</p>
                <span id="coinDisplay" class="font-bold text-yellow-400 text-3xl block">0</span>
            </div>
            <!-- 2. Rebirth -->
            <div class="col-span-1">
                <p class="text-base">ğŸŒŸ Rebirth:</p>
                <span id="rebirthDisplay" class="font-bold text-indigo-400 text-3xl block">0</span>
            </div>
            <!-- 3. RBP -->
            <div class="col-span-1">
                <p class="text-base text-purple-300">âš›ï¸ RBP (Puan):</p>
                <span id="rbpDisplay" class="font-semibold text-purple-400 text-2xl block">0</span>
            </div>
             <!-- 4. SBK (Net) -->
            <div class="col-span-1">
                <p class="text-base text-red-300">âš™ï¸ Pasif (SBK):</p>
                <span id="passiveRateDisplay" class="font-semibold text-red-400 text-2xl block">0</span>
            </div>
             <!-- TBK Display -->
            <div class="col-span-2">
                <p class="text-base text-green-300">âœ¨ TÄ±klama (TBK):</p>
                <span id="clickValueDisplay" class="font-semibold text-green-400 text-2xl block">1</span>
            </div>
            <!-- Autoclicker Durumu -->
            <div class="col-span-2 text-center">
                <p class="text-sm text-gray-400">âš¡ Otomatik TÄ±klama HÄ±zÄ±:</p>
                <span id="autoclickerDisplay" class="font-semibold text-blue-300 text-xl block">0 / sn</span>
            </div>
        </div>

        <!-- Gezinme (Navigation) -->
        <nav class="flex justify-center flex-wrap gap-4 mb-6">
            <button id="navClicker" class="nav-btn active px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 font-bold transition duration-150" onclick="switchView('clickerView')">TÄ±klama Merkezi</button>
            <button id="navMarket" class="nav-btn px-4 py-2 rounded-lg bg-yellow-600 hover:bg-yellow-700 font-bold transition duration-150" onclick="switchView('marketView')">Pazar (Para)</button>
            <button id="navRebirthStore" class="nav-btn px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 font-bold transition duration-150" onclick="switchView('rebirthStoreView')">RBP MaÄŸazasÄ±</button>
        </nav>

        <!-- GÃ¶rÃ¼nÃ¼m Konteynerleri -->
        
        <!-- 1. TÄ±klama Merkezi GÃ¶rÃ¼nÃ¼mÃ¼ -->
        <div id="clickerView" class="view-container">
            <div class="p-6 bg-gray-700 rounded-xl shadow-inner border border-blue-500">
                <h2 class="text-3xl font-bold mb-6 text-blue-300 text-center">TÄ±kla ve Kazan!</h2>
                
                <!-- TÄ±klama Butonu -->
                <button id="clickButton" 
                        class="w-full h-40 bg-blue-600 hover:bg-blue-700 text-white font-extrabold text-5xl rounded-lg border-b-6 border-blue-800 active:border-b-4 transition-all duration-75">
                    TIKLA!
                </button>

                <!-- Rebirth AlanÄ± -->
                <div class="mt-8 p-4 bg-purple-900 rounded-lg border-2 border-purple-500 text-center">
                    <h3 class="text-2xl font-bold text-purple-300 mb-2">Yeniden DoÄŸuÅŸ (Rebirth)</h3>
                    <p class="text-sm text-gray-300 mb-3">TÃ¼m ilerlemenizi sÄ±fÄ±rlayÄ±n, ancak kalÄ±cÄ± bir Ã§arpan ve RBP kazanÄ±n. (Gereksinim: 100 Net SBK)</p>
                    <button id="rebirthButton" onclick="performRebirth()"
                            class="px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-lg rounded-full shadow-lg transition duration-150">
                        YENÄ°DEN DOÄ
                    </button>
                </div>
            </div>
        </div>

        <!-- 2. Para Market GÃ¶rÃ¼nÃ¼mÃ¼ -->
        <div id="marketView" class="view-container hidden">
            <div class="p-6 bg-gray-700 rounded-xl shadow-inner border border-yellow-500">
                <h2 class="text-3xl font-bold mb-6 text-yellow-300 text-center">Pazar (Para YÃ¼kseltmeleri)</h2>
                <p class="text-sm text-gray-300 mb-4 text-center">ParalarÄ±nÄ±zÄ± harcayarak TÄ±klama veya Pasif gelirinizi kalÄ±cÄ± olarak artÄ±rÄ±n.</p>
                
                <div id="marketItems" class="space-y-4">
                    <!-- Market KartlarÄ± Buraya JS ile Eklenecek -->
                </div>
            </div>
        </div>

        <!-- 3. Rebirth PuanÄ± MaÄŸazasÄ± GÃ¶rÃ¼nÃ¼mÃ¼ -->
        <div id="rebirthStoreView" class="view-container hidden">
            <div class="p-6 bg-gray-700 rounded-xl shadow-inner border border-purple-500">
                <h2 class="text-3xl font-bold mb-6 text-purple-300 text-center">Yeniden DoÄŸuÅŸ MaÄŸazasÄ± (RBP)</h2>
                <p class="text-sm text-gray-300 mb-4 text-center">RBP puanlarÄ±nÄ±zÄ± harcayarak oyun boyunca kalÄ±cÄ± olarak etkili olacak yÃ¼kseltmeler alÄ±n.</p>
                
                <div id="rebirthStoreItems" class="space-y-4">
                    <!-- RBP MaÄŸazasÄ± KartlarÄ± Buraya JS ile Eklenecek -->
                </div>
            </div>
        </div>


        <!-- Mesaj Kutusu -->
        <div id="messageBox" class="fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 p-3 bg-red-600 text-white font-bold rounded-lg shadow-xl hidden transition duration-300 ease-in-out">
            Yeterli paranÄ±z yok!
        </div>

    </div>

    <!-- JavaScript Oyun MantÄ±ÄŸÄ± -->
    <script>
        // Oyun Durumu (State)
        let coins = 0;             // Toplam para
        let baseClickValue = 1;    // TÄ±klama baÅŸÄ±na temel kazanÃ§ (Ã§arpan hariÃ§)
        let basePassiveRate = 0;   // Saniye baÅŸÄ±na temel pasif kazanÃ§ (Ã§arpan hariÃ§)
        let rebirths = 0;          // Yeniden doÄŸuÅŸ sayÄ±sÄ±
        let rebirthMultiplier = 1; // Yeniden doÄŸuÅŸ ile gelen kalÄ±cÄ± Ã§arpan
        let passiveMultiplier = 1; // Marketten alÄ±nan pasif gelir Ã§arpanÄ±
        let rebirthPoints = 0;     // Rebirth PuanÄ± (RBP)
        
        // RBP MaÄŸazasÄ±'ndan gelen kalÄ±cÄ± Ã§arpanlar
        let rbpStartingCoinBonus = 0; // Her Rebirth sonrasÄ± baÅŸlangÄ±Ã§ parasÄ±
        let rbpPassiveSpeedBonus = 1; // Pasif hÄ±z Ã§arpanÄ± (daha kÃ¼Ã§Ã¼k sÃ¼reye bÃ¶leceÄŸiz)
        let rbpAutoclickerLevel = 0;  // Otomatik tÄ±klama seviyesi
        
        let lastSaveTime = Date.now(); // YENÄ°: Son kaydetme zamanÄ± (Ã‡evrimdÄ±ÅŸÄ± kazanÃ§ iÃ§in)

        // Sabitler
        const MAX_OFFLINE_TIME_SECONDS = 8 * 60 * 60; // Maksimum 8 saat Ã§evrimdÄ±ÅŸÄ± kazanÃ§

        // HTML Elementleri
        const coinDisplay = document.getElementById('coinDisplay');
        const rebirthDisplay = document.getElementById('rebirthDisplay');
        const rbpDisplay = document.getElementById('rbpDisplay'); 
        const clickValueDisplay = document.getElementById('clickValueDisplay');
        const passiveRateDisplay = document.getElementById('passiveRateDisplay');
        const autoclickerDisplay = document.getElementById('autoclickerDisplay'); 
        const clickButton = document.getElementById('clickButton');
        const marketItemsContainer = document.getElementById('marketItems');
        const rebirthStoreItemsContainer = document.getElementById('rebirthStoreItems'); 
        const messageBox = document.getElementById('messageBox');
        
        // Pazar Ã–ÄŸeleri Verisi (Para ile alÄ±nan)
        const MARKET_ITEMS = [
            { id: 1, name: "GeliÅŸmiÅŸ Parmak", cost: 10, initialCost: 10, multiplier: 1.5, type: 'click', value: 1, level: 0, maxLevel: 50, description: "TÄ±klama baÅŸÄ±na kazancÄ± 1 artÄ±rÄ±r." },
            { id: 2, name: "Otomatik TÄ±klayÄ±cÄ±", cost: 100, initialCost: 100, multiplier: 1.15, type: 'passive', value: 1, level: 0, maxLevel: 100, description: "Saniye baÅŸÄ±na 1 pasif gelir saÄŸlar." },
            { id: 3, name: "KÃ¼Ã§Ã¼k Madenci", cost: 500, initialCost: 500, multiplier: 1.2, type: 'passive', value: 5, level: 0, maxLevel: 25, description: "Saniye baÅŸÄ±na 5 pasif gelir saÄŸlar." },
            { id: 4, name: "Ä°ÅŸ Merkezi", cost: 5000, initialCost: 5000, multiplier: 1.3, type: 'passive', value: 50, level: 0, maxLevel: 10, description: "Saniye baÅŸÄ±na 50 pasif gelir saÄŸlar." },
            { id: 5, name: "Pasif Ã‡arpan KartÄ±", cost: 20000, initialCost: 20000, multiplier: 3.0, type: 'multiplier', value: 2, level: 0, maxLevel: 5, description: "Pasif gelirinizi (SBK) 2 katÄ±na Ã§Ä±karÄ±r." }
        ];

        // RBP MaÄŸazasÄ± Ã–ÄŸeleri Verisi (RBP ile alÄ±nan - KalÄ±cÄ±)
        const REBIRTH_ITEMS = [
            { id: 101, name: "BaÅŸlangÄ±Ã§ ParasÄ±", cost: 5, initialCost: 5, multiplier: 1.5, type: 'starting_coin', value: 10, level: 0, maxLevel: 10, description: "Her Rebirth sonrasÄ± 10 fazladan para ile baÅŸlar." },
            { id: 102, name: "Pasif HÄ±zlandÄ±rÄ±cÄ±", cost: 25, initialCost: 25, multiplier: 2.0, type: 'passive_speed', value: 0.1, level: 0, maxLevel: 5, description: "Pasif gelirin saniye tik sÃ¼resini kalÄ±cÄ± olarak %10 azaltÄ±r." },
            { id: 103, name: "Otomatik TÄ±klama", cost: 50, initialCost: 50, multiplier: 2.5, type: 'autoclick', value: 1, level: 0, maxLevel: 10, description: "Saniyede 1 Otomatik TÄ±klama ekler. (KalÄ±cÄ±)" }
        ];

        // ------------------------------------------------------------------
        // YARDIMCI FONKSÄ°YONLAR
        // ------------------------------------------------------------------

        /**
         * Bir sayÄ±yÄ± okunabilir formatta gÃ¶sterir (Ã–rn: 123456 -> 123.456).
         */
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + " M";
            }
            return Math.floor(num).toLocaleString('tr-TR');
        }
        
        /**
         * alert() yerine kullanÄ±lan basit mesaj kutusu.
         */
        function showMessage(message, type = 'error') {
            messageBox.textContent = message;
            messageBox.className = messageBox.className.replace(/\sbg-(red|green|purple)-\d+/g, '');
            
            if (type === 'error') {
                messageBox.classList.add('bg-red-600');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-600');
            } else if (type === 'info') {
                messageBox.classList.add('bg-purple-600');
            } else if (type === 'offline') {
                messageBox.classList.add('bg-blue-600');
            }

            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000); 
        }

        // ------------------------------------------------------------------
        // GÃ–RÃœNÃœM VE NAVÄ°GASYON
        // ------------------------------------------------------------------

        /**
         * GÃ¶rÃ¼nÃ¼mler (TÄ±klama Merkezi / Market) arasÄ±nda geÃ§iÅŸ yapar.
         */
        function switchView(viewId) {
            document.querySelectorAll('.view-container').forEach(view => {
                view.classList.add('hidden');
            });
            
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.remove('hidden');
            }

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            const navBase = viewId.replace('View', '');
            const navId = 'nav' + navBase.charAt(0).toUpperCase() + navBase.slice(1);
            
            const navButton = document.getElementById(navId);

            if (navButton) {
                navButton.classList.add('active');
            } else {
                console.error(`Gezinme dÃ¼ÄŸmesi bulunamadÄ±: ${navId}`);
            }
            
            // Market'e geÃ§ildiÄŸinde kartlarÄ± gÃ¼ncel olarak yeniden Ã§iz
            if (viewId === 'marketView') {
                renderMarket(MARKET_ITEMS, marketItemsContainer, buyItem, coins, 'ğŸ’°');
            }
            // RBP MaÄŸazasÄ±na geÃ§ildiÄŸinde kartlarÄ± gÃ¼ncel olarak yeniden Ã§iz
            if (viewId === 'rebirthStoreView') {
                renderMarket(REBIRTH_ITEMS, rebirthStoreItemsContainer, buyRebirthItem, rebirthPoints, 'âš›ï¸');
            }
        }

        // ------------------------------------------------------------------
        // OYUN MANTIK VE DÃ–NGÃœSÃœ
        // ------------------------------------------------------------------
        
        /**
         * Oyuncunun parasÄ±na tÄ±klama kazancÄ±nÄ± ekler.
         */
        function handleManualClick() {
            const actualClick = baseClickValue * rebirthMultiplier;
            coins += actualClick;
            updateDisplay();
            saveGame(); // Her tÄ±klamada kaydetmek yerine, 5 saniyelik autosave'e gÃ¼venebiliriz.
        }

        /**
         * Saniye baÅŸÄ±na kazanÃ§ ekler (Pasif Gelir).
         */
        function handlePassiveIncome() {
            if (basePassiveRate > 0) {
                // GerÃ§ek pasif kazanÃ§ = (Temel Pasif OranÄ±) * (Rebirth Ã‡arpanÄ±) * (Market Ã‡arpanÄ±)
                const actualPassive = basePassiveRate * rebirthMultiplier * passiveMultiplier;
                coins += actualPassive;
                updateDisplay();
            }
        }

        /**
         * Oyun durumunu (Para, TBK, SBK) ekranda gÃ¼nceller.
         */
        function updateDisplay() {
            // Hesaplanan Net DeÄŸerler
            const netClick = baseClickValue * rebirthMultiplier;
            const netPassive = basePassiveRate * rebirthMultiplier * passiveMultiplier;

            // Display null checkleri
            if (coinDisplay) coinDisplay.textContent = formatNumber(coins);
            if (rebirthDisplay) rebirthDisplay.textContent = formatNumber(rebirths);
            if (rbpDisplay) rbpDisplay.textContent = formatNumber(rebirthPoints); 
            
            // Ã‡arpanÄ± da gÃ¶stererek TBK/SBK'yÄ± gÃ¼ncelle
            if (clickValueDisplay) clickValueDisplay.textContent = `${formatNumber(netClick)} (x${rebirthMultiplier.toFixed(2)})`; 
            if (passiveRateDisplay) passiveRateDisplay.textContent = `${formatNumber(netPassive)} (x${(rebirthMultiplier * passiveMultiplier).toFixed(2)})`; 
            
            // Autoclicker HÄ±zÄ±nÄ± GÃ¼ncelle
            if (autoclickerDisplay) autoclickerDisplay.textContent = `${rbpAutoclickerLevel} / sn`;

            // Rebirth dÃ¼ÄŸmesinin durumunu kontrol et
            const rebirthBtn = document.getElementById('rebirthButton');
            const requiredPassiveRate = 100;
            if (rebirthBtn) { 
                 if (netPassive >= requiredPassiveRate) {
                     rebirthBtn.classList.replace('bg-indigo-600', 'bg-purple-600');
                     rebirthBtn.classList.add('hover:bg-purple-700');
                     rebirthBtn.disabled = false;
                } else {
                     rebirthBtn.classList.replace('bg-purple-600', 'bg-indigo-600');
                     rebirthBtn.classList.remove('hover:bg-purple-700');
                     rebirthBtn.disabled = true;
                }
            }
        }

        /**
         * Para ile satÄ±n alma iÅŸlemini gerÃ§ekleÅŸtirir.
         */
        function buyItem(item) {
            if (item.level >= item.maxLevel) {
                showMessage(`${item.name} zaten maksimum seviyede!`);
                return;
            }

            if (coins >= item.cost) {
                coins -= item.cost;
                item.level += 1;
                
                // Maliyeti artÄ±r (bir sonraki seviye iÃ§in)
                item.cost = Math.floor(item.initialCost * Math.pow(item.multiplier, item.level));
                
                // Etkileri gÃ¼ncelle
                if (item.type === 'click') {
                    baseClickValue += item.value;
                } else if (item.type === 'passive') {
                    basePassiveRate += item.value;
                } else if (item.type === 'multiplier') {
                    // PassiveMultiplier'Ä± Ã§arpan Ã¶ÄŸelerinin seviyelerine gÃ¶re yeniden hesapla
                    passiveMultiplier = 1;
                    MARKET_ITEMS.filter(i => i.type === 'multiplier').forEach(i => {
                        passiveMultiplier *= Math.pow(i.value, i.level);
                    });
                }
                
                updateDisplay();
                renderMarket(MARKET_ITEMS, marketItemsContainer, buyItem, coins, 'ğŸ’°');
                saveGame();
            } else {
                showMessage("Yeterli paranÄ±z yok!");
            }
        }

        /**
         * RBP ile satÄ±n alma iÅŸlemini gerÃ§ekleÅŸtirir.
         */
        function buyRebirthItem(item) {
            if (item.level >= item.maxLevel) {
                showMessage(`${item.name} zaten maksimum seviyede!`, 'info');
                return;
            }

            if (rebirthPoints >= item.cost) {
                rebirthPoints -= item.cost;
                item.level += 1;
                
                // Maliyeti artÄ±r (bir sonraki seviye iÃ§in)
                item.cost = Math.floor(item.initialCost * Math.pow(item.multiplier, item.level));
                
                // KalÄ±cÄ± etkileri gÃ¼ncelle
                if (item.type === 'starting_coin') {
                    rbpStartingCoinBonus += item.value;
                } else if (item.type === 'passive_speed') {
                    rbpPassiveSpeedBonus = 1; 
                    REBIRTH_ITEMS.filter(i => i.type === 'passive_speed').forEach(i => {
                        rbpPassiveSpeedBonus *= (1 - (i.value * i.level)); 
                    });
                    // Passive Income dÃ¶ngÃ¼sÃ¼nÃ¼ yeniden baÅŸlat (hÄ±z deÄŸiÅŸtiÄŸi iÃ§in)
                    clearInterval(window.passiveInterval);
                    startPassiveIncomeLoop();
                } else if (item.type === 'autoclick') { 
                    rbpAutoclickerLevel += item.value;
                    // Autoclicker dÃ¶ngÃ¼sÃ¼nÃ¼ yeniden baÅŸlat (seviye deÄŸiÅŸtiÄŸi iÃ§in)
                    clearInterval(window.autoclickerInterval);
                    startAutoclickerLoop();
                }
                
                updateDisplay();
                renderMarket(REBIRTH_ITEMS, rebirthStoreItemsContainer, buyRebirthItem, rebirthPoints, 'âš›ï¸');
                saveGame();
            } else {
                showMessage("Yeterli RBP'niz yok!", 'error');
            }
        }


        /**
         * Yeniden DoÄŸuÅŸ (Rebirth) iÅŸlemini gerÃ§ekleÅŸtirir.
         */
        function performRebirth() {
            const requiredPassiveRate = 100;
            const netPassive = basePassiveRate * rebirthMultiplier * passiveMultiplier; 

            if (netPassive < requiredPassiveRate) {
                showMessage(`Yeniden DoÄŸmak iÃ§in en az ${requiredPassiveRate} Net SBK oranÄ±na ulaÅŸmalÄ±sÄ±nÄ±z!`, 'error');
                return;
            }
            
            // 1. Rebirth PuanÄ± Hesaplama
            const rbpGained = Math.floor(netPassive / 100); 
            rebirthPoints += rbpGained;

            // 2. Rebirth ArtÄ±ÅŸÄ± ve Ã‡arpan Hesaplama
            rebirths += 1;
            rebirthMultiplier = 1 + (rebirths * 0.20); 

            // 3. SÄ±fÄ±rlama
            coins = rbpStartingCoinBonus; // RBP ile alÄ±nan baÅŸlangÄ±Ã§ parasÄ± bonusu
            baseClickValue = 1;
            basePassiveRate = 0;
            passiveMultiplier = 1; 

            // Item seviyelerini ve maliyetlerini sÄ±fÄ±rla
            MARKET_ITEMS.forEach(item => {
                item.level = 0;
                item.cost = item.initialCost;
            });

            // 4. GÃ¼ncelleme
            showMessage(`Yeniden DoÄŸuÅŸ BaÅŸarÄ±lÄ±! KazanÄ±lan RBP: ${rbpGained}. KalÄ±cÄ± Ã‡arpanÄ±nÄ±z: x${rebirthMultiplier.toFixed(2)}`, 'success');
            updateDisplay();
            renderMarket(MARKET_ITEMS, marketItemsContainer, buyItem, coins, 'ğŸ’°');
            renderMarket(REBIRTH_ITEMS, rebirthStoreItemsContainer, buyRebirthItem, rebirthPoints, 'âš›ï¸'); 
            saveGame();
        }


        /**
         * Market Ã¶ÄŸelerini DOM'a (ekrana) Ã§izer.
         */
        function renderMarket(items, container, buyFunction, currency, currencySymbol) {
            if (!container) return; 
            container.innerHTML = '';
            
            items.forEach(item => {
                const isAffordable = currency >= item.cost;
                const isMaxLevel = item.level >= item.maxLevel;
                
                let colorClass = 'text-green-400';
                if (item.type === 'passive') colorClass = 'text-red-400';
                if (item.type === 'multiplier') colorClass = 'text-blue-400';
                if (item.type === 'starting_coin' || item.type === 'passive_speed' || item.type === 'autoclick') colorClass = 'text-purple-400';

                const cardHtml = `
                    <div id="item-${item.id}" class="p-4 rounded-lg flex flex-col sm:flex-row items-start sm:items-center justify-between transition duration-200 ${isMaxLevel ? 'bg-gray-600 opacity-50' : isAffordable ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-700 opacity-70 cursor-not-allowed'}">
                        <div class="mb-2 sm:mb-0">
                            <h3 class="text-xl font-bold ${colorClass}">${item.name} <span class="text-base text-gray-400">(Seviye: ${item.level} / ${item.maxLevel})</span></h3>
                            <p class="text-sm text-gray-300">${item.description}</p>
                        </div>
                        <button class="buy-btn w-full sm:w-auto px-4 py-2 mt-2 sm:mt-0 rounded-lg font-bold transition duration-200" 
                                data-item-id="${item.id}"
                                data-currency-type="${currencySymbol === 'ğŸ’°' ? 'coin' : 'rbp'}"
                                ${isMaxLevel || !isAffordable ? 'disabled' : ''}
                                style="${isMaxLevel ? 'background-color: #4b5563; color: #9ca3af;' : isAffordable ? 'background-color: #f59e0b; color: #1f2937;' : 'background-color: #9ca3af; color: #4b5563; cursor: not-allowed;'}">
                            ${isMaxLevel ? 'MAX SEVÄ°YE' : `${formatNumber(item.cost)} ${currencySymbol} AL`}
                        </button>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
            
            // Yeni butonlara olay dinleyicisi ekle
            document.querySelectorAll(`#${container.id} .buy-btn`).forEach(button => {
                if (!button.disabled) {
                    button.addEventListener('click', (e) => {
                        const itemId = parseInt(e.currentTarget.getAttribute('data-item-id'));
                        const currencyType = e.currentTarget.getAttribute('data-currency-type');
                        
                        let item;
                        if (currencyType === 'coin') {
                            item = MARKET_ITEMS.find(i => i.id === itemId);
                            if (item) buyFunction(item);
                        } else if (currencyType === 'rbp') {
                            item = REBIRTH_ITEMS.find(i => i.id === itemId);
                            if (item) buyFunction(item);
                        }
                    });
                }
            });
        }

        // ------------------------------------------------------------------
        // PERÄ°YODÄ°K DÃ–NGÃœLER
        // ------------------------------------------------------------------
        
        /**
         * Pasif Gelir (SBK) dÃ¶ngÃ¼sÃ¼nÃ¼ ayarlar. (HÄ±z bonusuna gÃ¶re ayarlanÄ±r)
         */
        function startPassiveIncomeLoop() {
             // DÃ¶ngÃ¼ hÄ±zÄ±nÄ± rbpPassiveSpeedBonus'a gÃ¶re ayarla. (Min 100ms)
             const intervalMs = Math.max(100, Math.floor(1000 * rbpPassiveSpeedBonus)); 
             if (window.passiveInterval) clearInterval(window.passiveInterval);
             window.passiveInterval = setInterval(handlePassiveIncome, intervalMs);
             console.log(`Pasif Gelir DÃ¶ngÃ¼sÃ¼ baÅŸlatÄ±ldÄ±. AralÄ±k: ${intervalMs}ms`);
        }
        
        /**
         * Otomatik TÄ±klayÄ±cÄ± dÃ¶ngÃ¼sÃ¼nÃ¼ ayarlar.
         */
        function startAutoclickerLoop() {
            if (window.autoclickerInterval) clearInterval(window.autoclickerInterval);
            
            if (rbpAutoclickerLevel > 0) {
                // Autoclicker her saniye ateÅŸlenir
                window.autoclickerInterval = setInterval(() => {
                    // Seviye sayÄ±sÄ±nca tÄ±klama simÃ¼le et
                    for (let i = 0; i < rbpAutoclickerLevel; i++) {
                        handleManualClick();
                    }
                }, 1000);
                console.log(`Otomatik TÄ±klayÄ±cÄ± baÅŸlatÄ±ldÄ±. Saniyede ${rbpAutoclickerLevel} tÄ±klama.`);
            }
        }


        // ------------------------------------------------------------------
        // KALICI KAYIT (LOCAL STORAGE)
        // ------------------------------------------------------------------
        
        /**
         * Oyun durumunu Local Storage'a kaydeder.
         * AyrÄ±ca son kaydetme zamanÄ±nÄ± (lastSaveTime) gÃ¼ncel kaydÄ±n bir parÃ§asÄ± yapar.
         */
        function saveGame() {
            const gameState = {
                coins: coins, 
                baseClickValue: baseClickValue, 
                basePassiveRate: basePassiveRate, 
                rebirths: rebirths, 
                rebirthMultiplier: rebirthMultiplier, 
                passiveMultiplier: passiveMultiplier, 
                rebirthPoints: rebirthPoints,
                rbpStartingCoinBonus: rbpStartingCoinBonus, 
                rbpPassiveSpeedBonus: rbpPassiveSpeedBonus, 
                rbpAutoclickerLevel: rbpAutoclickerLevel,
                lastSaveTime: Date.now(), // YENÄ°: KayÄ±t zamanÄ±
                marketItems: MARKET_ITEMS.map(item => ({ id: item.id, level: item.level, cost: item.cost })),
                rebirthStoreItems: REBIRTH_ITEMS.map(item => ({ id: item.id, level: item.level, cost: item.cost })), 
            };
            localStorage.setItem('clickerGameSave', JSON.stringify(gameState));
        }

        /**
         * Oyun durumunu Local Storage'dan yÃ¼kler ve Ã§evrimdÄ±ÅŸÄ± kazancÄ± hesaplar.
         */
        function loadGame() {
            const savedState = localStorage.getItem('clickerGameSave');
            if (savedState) {
                const gameState = JSON.parse(savedState);
                
                // Temel deÄŸiÅŸkenleri yÃ¼kle
                coins = gameState.coins || 0;
                baseClickValue = gameState.baseClickValue || 1;
                basePassiveRate = gameState.basePassiveRate || 0;
                rebirths = gameState.rebirths || 0;
                rebirthMultiplier = gameState.rebirthMultiplier || 1;
                passiveMultiplier = gameState.passiveMultiplier || 1;
                rebirthPoints = gameState.rebirthPoints || 0; 
                rbpStartingCoinBonus = gameState.rbpStartingCoinBonus || 0; 
                rbpPassiveSpeedBonus = gameState.rbpPassiveSpeedBonus || 1; 
                rbpAutoclickerLevel = gameState.rbpAutoclickerLevel || 0; 
                lastSaveTime = gameState.lastSaveTime || Date.now(); // Son kaydetme zamanÄ±nÄ± yÃ¼kle

                // Item seviyelerini ve maliyetlerini yÃ¼kle (Para Market)
                if (gameState.marketItems) {
                    gameState.marketItems.forEach(savedItem => {
                        const item = MARKET_ITEMS.find(i => i.id === savedItem.id);
                        if (item) {
                            item.level = savedItem.level;
                            item.cost = savedItem.cost;
                            if(item.type === 'multiplier' && item.level > 0) {
                                passiveMultiplier *= Math.pow(item.value, item.level); 
                            }
                        }
                    });
                }
                
                // Item seviyelerini ve maliyetlerini yÃ¼kle (RBP MaÄŸazasÄ±)
                if (gameState.rebirthStoreItems) {
                    gameState.rebirthStoreItems.forEach(savedItem => {
                        const item = REBIRTH_ITEMS.find(i => i.id === savedItem.id);
                        if (item) {
                            item.level = savedItem.level;
                            item.cost = savedItem.cost;
                        }
                    });
                }

                // Ã‡EVRÄ°MDIÅI KAZANÃ‡ HESAPLAMASI (YENÄ°)
                const timePassedMs = Date.now() - lastSaveTime;
                const timePassedSeconds = Math.floor(timePassedMs / 1000);
                
                // Maksimum sÃ¼reyi uygula
                const effectiveOfflineTime = Math.min(timePassedSeconds, MAX_OFFLINE_TIME_SECONDS);
                
                // Net SBK oranÄ±
                const netPassiveRate = basePassiveRate * rebirthMultiplier * passiveMultiplier;
                
                if (effectiveOfflineTime > 0 && netPassiveRate > 0) {
                    const offlineGains = netPassiveRate * effectiveOfflineTime;
                    coins += offlineGains;
                    
                    const hours = Math.floor(effectiveOfflineTime / 3600);
                    const minutes = Math.floor((effectiveOfflineTime % 3600) / 60);
                    
                    let timeString = '';
                    if (hours > 0) timeString += `${hours} saat `;
                    if (minutes > 0) timeString += `${minutes} dakika`;
                    if (timeString === '') timeString = `${effectiveOfflineTime} saniye`;
                    
                    showMessage(`HoÅŸ geldiniz! ${timeString} boyunca Ã§evrimdÄ±ÅŸÄ±ydÄ±nÄ±z ve ${formatNumber(offlineGains)} ğŸ’° kazandÄ±nÄ±z!`, 'offline');
                } else if (effectiveOfflineTime > 0) {
                    showMessage("HoÅŸ geldiniz! Ã‡evrimdÄ±ÅŸÄ±ydÄ±nÄ±z ancak pasif geliriniz 0 olduÄŸu iÃ§in kazanÃ§ elde edemediniz.", 'info');
                } else {
                    showMessage("Oyun YÃ¼klendi!", 'success');
                }
                
                // KayÄ±t zamanÄ±nÄ± hemen gÃ¼ncelle
                lastSaveTime = Date.now();
                saveGame();
                
                updateDisplay();
                renderMarket(MARKET_ITEMS, marketItemsContainer, buyItem, coins, 'ğŸ’°');
                renderMarket(REBIRTH_ITEMS, rebirthStoreItemsContainer, buyRebirthItem, rebirthPoints, 'âš›ï¸');
                return true;
            }
            return false;
        }

        // ------------------------------------------------------------------
        // OYUN BAÅLATMA
        // ------------------------------------------------------------------

        /**
         * Oyunu baÅŸlatÄ±r ve olay dinleyicilerini kurar.
         */
        function initializeGame() {
            // KayÄ±t yÃ¼kle
            loadGame();

            // TÄ±klama olayÄ±nÄ± ata
            if (clickButton) clickButton.addEventListener('click', handleManualClick);
            
            // Pasif gelir dÃ¶ngÃ¼sÃ¼nÃ¼ baÅŸlat
            startPassiveIncomeLoop();
            
            // Otomatik TÄ±klayÄ±cÄ± dÃ¶ngÃ¼sÃ¼nÃ¼ baÅŸlat
            startAutoclickerLoop();
            
            // Otomatik KayÄ±t dÃ¶ngÃ¼sÃ¼nÃ¼ baÅŸlat (Her 5 saniyede bir)
            setInterval(saveGame, 5000);

            // Ä°lk gÃ¶sterimi gÃ¼ncelle ve gÃ¶rÃ¼nÃ¼mÃ¼ ayarla
            updateDisplay();
            switchView('clickerView'); // BaÅŸlangÄ±Ã§ta tÄ±klama merkezini gÃ¶ster
        }

        // Oyun baÅŸladÄ±ÄŸÄ±nda baÅŸlatma fonksiyonunu Ã§aÄŸÄ±r
        document.addEventListener('DOMContentLoaded', initializeGame);
        
    </script>
</body>
</html>
